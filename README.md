# Парсер ВКонтакте → Телеграм

Парсер для автоматического скачивания постов с видео из групп ВКонтакте и публикации их в Телеграм-канал по расписанию.

## Возможности

- Скачивание постов с видео из групп ВКонтакте
- Публикация постов в Телеграм-канал по расписанию (10:00, 13:00, 16:00, 19:00 по МСК)
- Выбор случайных постов, начиная с 01.01.2025
- Отслеживание уже опубликованных постов для избежания повторов
- Использование yt-dlp для скачивания видео
- Автоматическое сжатие видео с помощью ffmpeg для соответствия ограничениям Telegram
- Конвертация видео в формат MP4 для корректного отображения в Telegram

## Требования

- Python 3.7+
- Токен доступа к API ВКонтакте
- Бот Telegram и его токен
- ID Телеграм-канала
- Установленный yt-dlp
- Установленный ffmpeg (для сжатия и конвертации видео)

## Установка

1. Клонируйте репозиторий:
```
git clone <url-репозитория>
cd <директория-проекта>
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Установите yt-dlp (если еще не установлен):
```
pip install yt-dlp
```

4. Установите ffmpeg:
   - Windows: Скачайте с [официального сайта](https://ffmpeg.org/download.html) и добавьте в PATH
   - Linux: `sudo apt-get install ffmpeg`
   - macOS: `brew install ffmpeg`

5. Создайте файл `.env` на основе `.env-example` и заполните его своими данными:
```
cp .env-example .env
```

6. Отредактируйте файл `config.py`, добавив ID или короткие имена групп ВКонтакте в список `VK_GROUPS`.

## Настройка

### Получение токена ВКонтакте

1. Создайте приложение ВКонтакте на странице [vk.com/dev/apps](https://vk.com/dev/apps)
2. Получите токен доступа с правами на чтение стены групп
3. Добавьте токен в файл `.env`

### Настройка бота Telegram

1. Создайте бота через [@BotFather](https://t.me/BotFather) в Telegram
2. Получите токен бота и добавьте его в файл `.env`
3. Добавьте бота в ваш канал как администратора с правами на публикацию сообщений
4. Укажите ID канала в файле `.env` (с префиксом @)

## Использование

### Обычный режим

Запустите парсер:
```
python vk_tg_parser.py
```

Парсер будет работать в фоновом режиме, публикуя посты в указанное время.

### Тестовый режим

Для проверки работоспособности парсера можно запустить его в тестовом режиме, который опубликует один случайный пост и завершит работу:
```
python vk_tg_parser.py --test
```

Это полезно для проверки настроек и доступа к API ВКонтакте и Telegram.

## Настройка расписания

По умолчанию посты публикуются в 10:00, 13:00, 16:00 и 19:00 по московскому времени. Вы можете изменить это расписание в файле `config.py`, отредактировав список `POSTING_TIMES`.

## Логирование

Все действия парсера записываются в файл `parser.log`. Вы можете использовать его для отладки и мониторинга работы программы.

## Примечания

- Парсер сохраняет список опубликованных постов в файле `published_posts.json`
- Временные файлы видео хранятся в директории `temp_videos` и удаляются после публикации
- Для корректной работы необходимо стабильное интернет-соединение
- Telegram ограничивает размер видео до 50 МБ, более крупные файлы будут автоматически сжаты
- Все видео конвертируются в формат MP4 для корректного отображения в Telegram
- Если видео не удается сжать до требуемого размера, оно не будет опубликовано 